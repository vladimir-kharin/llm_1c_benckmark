
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	//Вставить содержимое обработчика
КонецПроцедуры

&НаКлиенте
Процедура ВвестиДопРасходы(Команда)
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("Заголовок", "Ввод дополнительных расходов");
	ПараметрыФормы.Вставить("Текст", "Введите сумму дополнительных расходов:");
	ПараметрыФормы.Вставить("Значение", 0);
	
	Оповещение = Новый ОписаниеОповещения(
		ЭтотОбъект,
		"ОбработчикВводаДопРасходов",
		ПараметрыФормы
	);
	
	ВвестиЧисло(Оповещение, ПараметрыФормы.Значение);
КонецПроцедуры

&НаКлиенте
Процедура ОбработчикВводаДопРасходов(Результат, Параметры) Экспорт
	Если Результат = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если Объект.Товары.Количество() = 0 Тогда
		Предупреждение("Нет товаров для распределения расходов!");
		Возврат;
	КонецЕсли;
	
	ОбщаяСумма = Объект.Товары.Итог("Сумма");
	Если ОбщаяСумма <= 0 Тогда
		Предупреждение("Общая сумма товаров должна быть больше нуля!");
		Возврат;
	КонецЕсли;
	
	ДопРасходы = Результат;
	
	Для каждого СтрокаТовара Из Объект.Товары Цикл
		Доля = СтрокаТовара.Сумма / ОбщаяСумма;
		СтрокаТовара.СуммаДопРасходы = ДопРасходы * Доля;
	КонецЦикла;
	
	Элементы.Товары.Обновить();
	Сообщить("Дополнительные расходы распределены на сумму: " + ДопРасходы);
КонецПроцедуры

&НаКлиенте
Процедура ТоварыКоличествоПриИзменении(Элемент)
	ТекущаяСтрока = Элемент.Родитель.ТекущиеДанные;
	ТекущаяСтрока.Сумма = ТекущаяСтрока.Количество * ТекущаяСтрока.Цена;
	ТекущаяСтрока.СуммаВсего = ТекущаяСтрока.Сумма + ТекущаяСтрока.СуммаДопРасходы;
КонецПроцедуры

&НаКлиенте
Процедура ТоварыЦенаПриИзменении(Элемент)
	ТекущаяСтрока = Элемент.Родитель.ТекущиеДанные;
	ТекущаяСтрока.Сумма = ТекущаяСтрока.Количество * ТекущаяСтрока.Цена;
	ТекущаяСтрока.СуммаВсего = ТекущаяСтрока.Сумма + ТекущаяСтрока.СуммаДопРасходы;
КонецПроцедуры

&НаКлиенте
Процедура ТоварыСуммаДопРасходыПриИзменении(Элемент)
	ТекущаяСтрока = Элемент.Родитель.ТекущиеДанные;
	ТекущаяСтрока.СуммаВсего = ТекущаяСтрока.Сумма + ТекущаяСтрока.СуммаДопРасходы;
КонецПроцедуры

&НаКлиенте
Процедура ТоварыСуммаВсегоПриИзменении(Элемент)
	// Вставить содержимое обработчика.
КонецПроцедуры

&НаКлиенте
Процедура ВалютаПриИзменении(Элемент)
	// Вставить содержимое обработчика.
КонецПроцедуры
