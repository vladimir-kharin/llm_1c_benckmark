&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	//Вставить содержимое обработчика
КонецПроцедуры

&НаКлиенте
Функция РассчитатьСумму(Количество, Цена)
	// Функция для расчета суммы (Количество * Цена)
	Если ЗначениеЗаполнено(Количество) и ЗначениеЗаполнено(Цена) Тогда
		Возврат Количество * Цена;
	Иначе
		Возврат Неопределено;
	КонецЕсли;
КонецФункции

&НаКлиенте
Функция РассчитатьСуммуВсего(Сумма, СуммаДопРасходы)
	// Функция для расчета суммы всего (Сумма + СуммаДопРасходы)
	Если ЗначениеЗаполнено(Сумма) и ЗначениеЗаполнено(СуммаДопРасходы) Тогда
		Возврат Сумма + СуммаДопРасходы;
	Иначе
		Возврат Неопределено;
	КонецЕсли;
КонецФункции

&НаКлиенте
Процедура ОбновитьРассчеты(Элемент)
	// Получаем строку табличной части
	Строка = Элемент.Родитель.ТекущиеДанные;
	
	// Получаем значения полей
	Количество = Строка.Количество;
	Цена = Строка.Цена;
	СуммаДопРасходы = Строка.СуммаДопРасходы;
	
	// Рассчитываем сумму
	Строка.Сумма = РассчитатьСумму(Количество, Цена);
	
	// Рассчитываем сумму всего
	Строка.СуммаВсего = РассчитатьСуммуВсего(Строка.Сумма, СуммаДопРасходы);
	
	// Обновляем отображение
	Элемент.Родитель.ТекущиеДанные.Сумма = Строка.Сумма;
	Элемент.Родитель.ТекущиеДанные.СуммаВсего = Строка.СуммаВсего;
КонецПроцедуры

&НаКлиенте
Процедура ТоварыКоличествоПриИзменении(Элемент)
	// При изменении количества пересчитываем сумму и сумму всего
	ОбновитьРассчеты(Элемент);
КонецПроцедуры

&НаКлиенте
Процедура ТоварыЦенаПриИзменении(Элемент)
	// При изменении цены пересчитываем сумму и сумму всего
	ОбновитьРассчеты(Элемент);
КонецПроцедуры

&НаКлиенте
Процедура ТоварыСуммаДопРасходыПриИзменении(Элемент)
	// При изменении суммы доп расходов пересчитываем сумму всего
	Строка = Элемент.Родитель.ТекущиеДанные;
	Строка.СуммаВсего = РассчитатьСуммуВсего(Строка.Сумма, Строка.СуммаДопРасходы);
	Элемент.Родитель.ТекущиеДанные.СуммаВсего = Строка.СуммаВсего;
КонецПроцедуры

&НаКлиенте
Процедура ТоварыСуммаВсегоПриИзменении(Элемент)
	// При изменении суммы всего, не выполняем никаких действий
	// так как это поле должно рассчитываться, а не изменяться вручную
	// Можно добавить предупреждение или сброс значения
	Сообщить("Поле СуммаВсего рассчитывается автоматически и не должно изменяться вручную.");
	ОбновитьРассчеты(Элемент);
КонецПроцедуры

&НаКлиенте
Процедура ВалютаПриИзменении(Элемент)
	// Вставить содержимое обработчика.
КонецПроцедуры

&НаКлиенте
Процедура ВвестиДопРасходы(Команда)
    // Показываем диалог для ввода дополнительного расхода
    Оповещение = Новый ОписаниеОповещения("ПослеВводаДопРасходов", ЭтотОбъект);
    ПоказатьВводЧисла(Оповещение, , "Введите сумму дополнительного расхода", 10, 2);
КонецПроцедуры

&НаКлиенте
Процедура ПослеВводаДопРасходов(Сумма, Параметры) Экспорт
    // Обрабатываем введенную сумму дополнительного расхода
    Если Сумма <> Неопределено Тогда
        // Получаем текущую строку табличной части
        Элемент = Параметры.Элемент;
        Если Элемент <> Неопределено И Элемент.Родитель <> Неопределено Тогда
            Строка = Элемент.Родитель.ТекущиеДанные;
            Если Строка <> Неопределено Тогда
                // Устанавливаем введенную сумму в поле ДопРасходы
                Строка.ДопРасходы = Сумма;
                // Пересчитываем итоговую сумму
                ОбновитьРассчеты(Элемент);
            КонецЕсли;
        КонецЕсли;
    КонецЕсли;
КонецПроцедуры
