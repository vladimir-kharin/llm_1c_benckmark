# Работа с данными формы в 1С

### Реквизиты формы и объекта

---

## Доступ к реквизитам формы

```1c
// --- В контексте НаКлиенте или НаСервере ---

// Прямой доступ к реквизитам формы
ЗначениеРеквизита = ЭтотОбъект.Реквизит;
ЭтотОбъект.Реквизит = "Новое значение";

// То же самое проще
ЗначениеРеквизита = РеквизитФормы;
РеквизитФормы = "Новое значение";

// Доступ к реквизитам через просмотр свойств
ЗначениеЧерезСвойства = ЭтотОбъект["Реквизит"];

```

---

## Доступ к реквизитам объекта формы

```1c
// Объект связанный с формой обычно доступен через свойство Объект
ОбъектДокумента = Объект;  // например, ДокументОбъект.ПриходнаяНакладная

// Доступ к реквизитам объекта
Номер = Объект.Номер;
Объект.Дата = ТекущаяДата();
Объект.Комментарий = "Создан автоматически";

// Доступ к табличной части объекта
КоличествоСтрок = Объект.Товары.Количество();
ПервыйЭлемент = Объект.Товары[0];
СуммаДокумента = Объект.Товары.Итог("Сумма");

// Получение ссылки на объект
СсылкаНаОбъект = Объект.Ссылка;
```

---

## Работа с таблицами формы

```1c
// --- Таблица как реквизит формы ---

// Доступ к данным
Товар = ТаблицаФормы[0].Наименование;
ТаблицаФормы[1].Количество = 10;

// --- Таблица как табличная часть объекта ---

// Добавление строки
НоваяСтрока = Объект.Товары.Добавить();
НоваяСтрока.Номенклатура = Справочники.Номенклатура.НайтиПоКоду("12345");
НоваяСтрока.Количество = 5;
НоваяСтрока.Цена = 1000;
НоваяСтрока.Сумма = НоваяСтрока.Количество * НоваяСтрока.Цена;

// Удаление строк
Объект.Товары.Удалить(0);  // по индексу
Объект.Товары.Очистить();  // все строки
```

---

## Работа с текущими данными таблицы

```1c
// --- На клиенте ---
&НаКлиенте
Процедура ТоварыВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
    // Получение текущих данных строки на клиенте
    ТекСтрока = Элементы.Товары.ТекущиеДанные;
    
    Если ТекСтрока <> Неопределено Тогда
        // Доступ к полям текущей строки
        ТекущееНаименование = ТекСтрока.Наименование;
        ТекСтрока.Количество = 10;
        ТекСтрока.Сумма = ТекСтрока.Количество * ТекСтрока.Цена;
    КонецЕсли;
КонецПроцедуры

// --- На сервере ---
&НаСервере
Процедура ОбработатьСтрокуНаСервере()
    // Получение идентификатора текущей строки
    ИдСтроки = Элементы.Товары.ТекущаяСтрока;
    
    // Доступ к строке табличной части объекта
    Если ИдСтроки <> Неопределено Тогда
        ТекущаяСтрокаТЧ = Объект.Товары.НайтиПоИдентификатору(ИдСтроки);
        
        Если ТекущаяСтрокаТЧ <> Неопределено Тогда
            // Работа с данными строки
            ТекущаяСтрокаТЧ.Количество = 5;
            ТекущаяСтрокаТЧ.Сумма = ТекущаяСтрокаТЧ.Количество * ТекущаяСтрокаТЧ.Цена;
        КонецЕсли;
    КонецЕсли;
КонецПроцедуры

// Для таблицы, которая является реквизитом формы
&НаСервере
Процедура ОбработатьСтрокуРеквизитаФормыНаСервере()
    ИдСтроки = Элементы.ТаблицаТоваров.ТекущаяСтрока;
    
    Если ИдСтроки <> Неопределено Тогда
        ТекущаяСтрокаТЗ = ТаблицаТоваров.НайтиПоИдентификатору(ИдСтроки);
        
        Если ТекущаяСтрокаТЗ <> Неопределено Тогда
            ТекущаяСтрокаТЗ.Количество = 5;
        КонецЕсли;
    КонецЕсли;
КонецПроцедуры
```

---

## Обработка событий таблицы

```1c
// --- При изменении ячейки таблицы на клиенте ---
&НаКлиенте
Процедура ТоварыКоличествоПриИзменении(Элемент)
    // Получение текущих данных
    ТекДанные = Элементы.Товары.ТекущиеДанные;
    
    Если ТекДанные <> Неопределено Тогда
        // Пересчет суммы при изменении количества
        ТекДанные.Сумма = ТекДанные.Количество * ТекДанные.Цена;
    КонецЕсли;
    
    // Вызов серверной процедуры
    ПересчитатьИтоги();
КонецПроцедуры

// --- При начале редактирования строки ---
&НаКлиенте
Процедура ТоварыПриНачалеРедактирования(Элемент, НоваяСтрока, Копирование)
    Если НоваяСтрока Тогда
        // Инициализация новой строки
        Элемент.ТекущиеДанные.Количество = 1;
        Элемент.ТекущиеДанные.Цена = 0;
    КонецЕсли;
КонецПроцедуры

// --- Серверная процедура для работы с таблицей ---
&НаСервереБезКонтекста
Функция РассчитатьСумму(Количество, Цена) Экспорт
    // Функция без контекста для расчетов
    Возврат Количество * Цена;
КонецФункции

&НаСервере
Процедура ПересчитатьИтоги()
    // Расчет итоговых значений документа
    ИтоговаяСумма = Объект.Товары.Итог("Сумма");
    Объект.СуммаДокумента = ИтоговаяСумма;
КонецПроцедуры
```

---

## Изменение видимости и доступности элементов формы

```1c
// --- Управление элементами формы ---

// Управление видимостью и доступностью
Элементы.Товары.Видимость = Истина;
Элементы.ГруппаИтоги.Доступность = (Объект.Товары.Количество() > 0);

// Установка только чтения для колонки таблицы
Элементы.ТоварыСумма.ТолькоПросмотр = Истина;

// Выделение текущей строки
Элементы.Товары.ТекущаяСтрока = ИдентификаторСтроки;
```

---

## Передача данных между клиентом и сервером

```1c
// --- Передача данных из клиента на сервер ---
&НаКлиенте
Процедура ОбработатьТовары(Команда)
    // Получение данных на клиенте
    ТекСтрока = Элементы.Товары.ТекущиеДанные;
    
    Если ТекСтрока <> Неопределено Тогда
        // Передача параметров на сервер
        ПараметрыСтроки = Новый Структура;
        ПараметрыСтроки.Вставить("Номенклатура", ТекСтрока.Номенклатура);
        ПараметрыСтроки.Вставить("Количество", ТекСтрока.Количество);
        
        // Вызов серверной процедуры с параметрами
        ДанныеТовара = ПолучитьДанныеТовараНаСервере(ПараметрыСтроки);
        
        // Обработка полученных данных
        Если ДанныеТовара <> Неопределено Тогда
            ТекСтрока.Цена = ДанныеТовара.Цена;
            ТекСтрока.Сумма = ТекСтрока.Количество * ТекСтрока.Цена;
        КонецЕсли;
    КонецЕсли;
КонецПроцедуры

// --- Серверная функция, возвращающая данные клиенту (получение данных из БД может быть только на сервере) ---
&НаСервере
Функция ПолучитьДанныеТовараНаСервере(ПараметрыСтроки)
    // Получение данных на сервере
    РезультатЗапроса = Новый Структура;
    
    Запрос = Новый Запрос;
    Запрос.Текст = "ВЫБРАТЬ
    |   Номенклатура.Цена
    |ИЗ
    |   Справочник.Номенклатура
    |ГДЕ
    |   Номенклатура.Ссылка = &Номенклатура";
    
    Запрос.УстановитьПараметр("Номенклатура", ПараметрыСтроки.Номенклатура);
    
    Выборка = Запрос.Выполнить().Выбрать();
    Если Выборка.Следующий() Тогда
        РезультатЗапроса.Вставить("Цена", Выборка.Цена);
    КонецЕсли;
    
    Возврат РезультатЗапроса;
КонецФункции
```

---

## Особенности работы с контекстами

```1c
// --- Важно помнить ---

// 1. НаКлиенте и НаСервере - доступ к контексту формы
&НаКлиенте       // Выполняется в клиентском приложении
&НаСервере       // Выполняется на сервере с контекстом

// 2. НаСервереБезКонтекста и НаКлиентеНаСервереБезКонтекста - 
// не имеют доступа к реквизитам формы и объекта
&НаСервереБезКонтекста    // Выполняется на сервере без контекста
&НаКлиентеНаСервереБезКонтекста  // Может быть вызвана и на клиенте и на сервере

```

---
